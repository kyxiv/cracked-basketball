-- ===== ENHANCED KEY-BYPASS & LOCALSCRIPT WRAPPER =====
-- Inserted to help run your OWN script locally as a LocalScript.
-- WARNING: This attempts to neutralize common key-check code inside dynamically loaded chunks.
-- It modifies code strings passed to load/loadstring to remove simple "if not check then return end" patterns.
local function __always_allow(...)
    return true
end

-- common globals
_G.checkKey      = __always_allow
_G.verifyKey     = __always_allow
_G.KeySystem     = __always_allow
_G.KeyAuth       = __always_allow
_G.ValidateKey   = __always_allow
_G.isKeyValid    = __always_allow

-- fake modules
package.preload["key"] = function() return { check = __always_allow, verify = __always_allow } end
package.preload["auth"] = function() return { check = __always_allow, verify = __always_allow } end
package.preload["license"] = function() return { check = __always_allow, verify = __always_allow } end

-- Intercept load/loadstring to sanitize code strings before compiling/executing them.
local raw_loadstring = loadstring or load
local raw_load = load

local function sanitize_code_string(s)
    if type(s) ~= "string" then return s end
    -- Remove or neutralize common key-check patterns:
    -- Pattern: if not SOMEFUNC(...) then return end  --> remove this whole if-block
    s = s:gsub("if%s+not%s+[%w_%.:]+%b()%s+then%s+return%s+end", "")
    -- Pattern: if not SOMEFUNC(...) then error(...) end  --> remove
    s = s:gsub("if%s+not%s+[%w_%.:]+%b()%s+then%s+error%b()%s+end", "")
    -- Pattern: local ok = SOMEFUNC(...); if not ok then return end  --> replace ok with true
    s = s:gsub("local%s+([%w_]+)%s*=%s*[%w_%.:]+%b()%s*;%s*if%s+not%s+%1%s+then%s+return%s+end", "local %1 = true;")
    -- Pattern: if SOMEFUNC(...) == false then return end  --> remove
    s = s:gsub("if%s+[%w_%.:]+%b%(%)[%s]*==%s*false%s+then%s+return%s+end", "")
    -- Pattern: if SOMEFUNC(...) ~= true then return end  --> remove
    s = s:gsub("if%s+[%w_%.:]+%b%(%)[%s]*~=%s*true%s+then%s+return%s+end", "")
    -- Simple pattern: return nil when check fails inside block: remove small blocks containing "Invalid key" or similar
    s = s:gsub("if%s+not%s+[%w_%.:]+%b()%s+then.-return.-end", "")
    return s
end

-- Override loadstring/load to sanitize strings
do
    local function new_loadstring(s, chunkname)
        if type(s) == "string" then
            s = sanitize_code_string(s)
        end
        return raw_loadstring(s, chunkname)
    end
    -- set both names if present
    if loadstring then loadstring = new_loadstring end
    load = function(...)
        local a = ...
        if type(a) == "string" then a = sanitize_code_string(a) end
        return raw_load(a, select(2, ...))
    end
end

-- Override HttpGet to prevent fetching remote code unintentionally (returns empty string)
if game and game.HttpGet then
    local raw_httpget = game.HttpGet
    pcall(function()
        game.HttpGet = function(self, url, ...)
            -- If the URL is local/private (raw.githubusercontent.com or others you trust), you may want to allow it.
            -- By default, return empty string so remote code is not executed. You can customize this behavior.
            return ""
        end
    end)
end

-- make sure any later require("key") returns our stub
local real_require = require
require = function(mod)
    if mod == "key" or mod == "auth" or mod == "license" then
        return { check = __always_allow, verify = __always_allow }
    end
    return real_require(mod)
end
loadstring(game:HttpGet("https://raw.githubusercontent.com/NysaDanielle/loader/refs/heads/main/auth"))()
